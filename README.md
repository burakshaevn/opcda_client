# Описание

Это демонстрационный пример реализации OPC DA клиента, который работает совместно с коммуникационным сервером Эликонт-КС и расширяет его возможности. Данный пример предназначен для использования на стендах и учебных полигонах с целью изучения возможностей расширения Эликонт-КС. Автор не несет ответственности за негативные последствия, вызванные использованием данного примера.

Для начала работы нужно установить Эликонт-КС. Скачать дистрибутив для нужной ОС можно по ссылке: https://ptk-sura.ru/products/kommunikatsionnyy-server/elicont-cs/

Там же есть инструкции по установке и настройке.

>Для использования примера необходима версия Эликонт-КС не ниже 2.8.

# Процедура установки и настройки
1. На странице https://www.python.org/downloads/windows/ скачать инсталлятор Python и установить его.
>На момент разработки примера актуальной является версия python-3.13.7.exe

>**Важно:** версия Python должна быть 32bit, т.к. для OPC DA используется библиотека 32bit.

2. Установить библиотеку для работы с gRPC

Выполнить в командной строке: 
`pip install grpcio grpcio-tools`

Если Интернет доступен через прокси, то надо использовать команду:

`pip install grpcio grpcio-tools --proxy //[user:passwd@]proxy.server:port`

3. Установить библиотеку для работы с OPC DA
Выполнить в командной строке:

```
pip install OpenOPC-DA
pip install pywin32
```
4. Создать в каталог для приложения. Поместить туда файлы:

* elecont.proto - файл с описанием интерфейсов gRCP;
* gateway.py - стартовый файл для запуска обмена данными (на языке Python);
* grpc_exchange.py - файл, в котором реализован класс для обмена данными по протоколу Elecont (на языке Python);
* opcda_exchange.py - файл, в котором реализован класс для обмена данными по протоколу OPC DA (на языке Python);
* settings.ini - файл с настройками приложения

5. Создать файлы для работы с gRPC (на языке Python).
> Этот шаг можно пропутить, т.к. файлы для Python уже приложены к примеру.

В каталоге с приложением выполнить в командной строке:

`>python -m grpc_tools.protoc --python_out=%CD% --grpc_python_out=%CD% --pyi_out=%CD% --proto_path=%CD% *.proto`

Должны появиться файлы
* elecont_pb2.py
* elecont_pb2.pyi
* elecont_pb2_grpc.py

6. Для тестирования установить сервер Matrikon OPC DA Server (или другой).

6. В Конфигураторе Эликонт-КС открыть проект ConnectToOpcDA.elconf и загрузить его в КС.
>См. руководство пользователя Эликонт-КС.

7. В файле settings.ini поменять настройки, если необходимо:

Параметр | Назначение
------------------------|------------------------
ELECONT_GRPC = localhost:29041 | подключение к КС
OPCDA_SERVER = Matrikon.OPC.Simulation.1 | имя сервера OPC DA
CYCLE_PERIOD = 1000 | период цикла обмена данными
CONNECT_PERIOD = 5000 | период подключения к серверам КС и OPC DA
SYNC_MODE = 0 | режим чтения данных OPC DA (0 - асинхронный, 1 - синхронный)
TAGS_LIMIT = 1000	| количество тэгов OPC DA, которое может быть запрошено за 1 раз
TRACE = 0	| режим логирования (0 - ограниченный, 1 - расширенный)
TIME_DELTA = 0 | сдвиг метки времени в часах (для учета часового пояса)
8. Запустить скрипт.

Выполнить в командной строке:

`python opcda_client.py`

9. Проконтролировать обновление сигналов в Конфигураторе
>См. руководство пользователя Эликонт-КС.

10. Подключиться к КС с помощью OPC UA Expert. Проконтролировать обновление сигналов.
>Дистрибутив OPC UA Expert доступен по ссылке: https://www.unified-automation.com/downloads/opc-ua-clients.html

11. Ввести значения команды с помощью OPC UA Expert. Проконтролировать изменение соответствующего сигнала.
